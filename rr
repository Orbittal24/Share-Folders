socket.on('getGlobalIngersollData', async (pack_name, pack_no) => {
    console.log('pack_name, pack_no:::::::::::', pack_name, pack_no);

    try {
        // First API call to get Pack_ID
        const packResponse = await fetch(`https://Misapp.tataautocomp.com:5555/packs?Pack_Name=${encodeURIComponent(pack_name)}`);
        const packData = await packResponse.json();
        console.log("Pack API result:", packData);

        if (!packData || packData.length === 0 || !packData[0].Pack_ID) {
            console.log(`No pack_id found for pack_name: ${pack_name}`);
            return;
        }

        const pack_id = packData[0].Pack_ID;

        // Extract last 6 digits of pack_no
        const last6 = pack_no.slice(-6);

        // Second API call using pack_id + last6
        const dupResponse = await fetch(`https://Misapp.tataautocomp.com:5555/pack-duplicates?Pack_No=${last6}&Pack_ID=${pack_id}`);
        const dupData = await dupResponse.json();
        console.log("Second API result:", dupData);

        if (!dupData || dupData.length === 0) {
            console.log(`No duplicate pack data found for pack_no: ${last6}`);
            return;
        }

        const packNumber = dupData[0].Pack_No;
        const packCreationDate = dupData[0].Pack_creation_Date;

        // Convert packCreationDate to dd-mm-yy
        const dateObj = new Date(packCreationDate);
        const dd = String(dateObj.getDate()).padStart(2, "0");
        const mm = String(dateObj.getMonth() + 1).padStart(2, "0");
        const yy = String(dateObj.getFullYear()).slice(-2);
        const formattedDate = `${dd}-${mm}-${yy}`;  // dd-mm-yy

        // Third API call
        const thirdApiUrl = `https://Misapp.tataautocomp.com:5555/tray-bolting-like-table?pack_number=${packNumber}&pack_date=${formattedDate}`;
        console.log("Third API URL:", thirdApiUrl);

        const thirdResponse = await fetch(thirdApiUrl);
        const thirdData = await thirdResponse.json();
        console.log("Third API result:", thirdData);

    } catch (error) {
        console.error("Error in API flow:", error);
    }
});
