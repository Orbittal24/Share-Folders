socket.on("getFinalQRCodeStatus_nova_pa_gun5", async (battery_qrcode) => {
    try {
        const requestData = {
            station_id: 7,
            line_id: 4,
            customer_qrcode: battery_qrcode
        };
        console.log("requestData:::::::", requestData);

        // Call API
        const response = await fetch("https://mismainapp.tataautocomp.com:3241/station_interlock", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(requestData),
        });

        if (!response.ok) {
            console.error("Interlock API error:", response.status, response.statusText);
            socket.emit("setFinalQRCodeStatus", { error: true }, battery_qrcode);
            return;
        }

        // Parse JSON body
        const result = await response.json();
        console.log("API result:", JSON.stringify(result, null, 2));


        // Send entire API response back to frontend
        socket.emit("setFinalQRCodeStatus", result, battery_qrcode);

    } catch (error) {
        console.error("API error:", error.message);
        socket.emit("setFinalQRCodeStatus", { error: true }, battery_qrcode);
    }
});




 //////////VIR api interlock
        socket.on("setFinalQRCodeStatus", function (data, battery_qrcode) {
    globalBatteryFinalQRCode = battery_qrcode;

    if (data.error) {
        Swal.fire("Error", "Could not fetch process status. Try again.", "error");
        return;
    }

    // Safely extract voltage_ir_status from rows[0]
    const voltageStatus = data[0]?.rows?.[0]?.voltage_ir_status || "OK";

    function showVoltagePopup() {
        Swal.fire({
            title: "Voltage IR Pending!",
            text: `Please check ADMIN to see which module is pending !`,          
           // text: `Pending for module : ${globalBatteryFinalQRCode}`,
            icon: "info",
            confirmButtonText: "OK",
            allowOutsideClick: false, // prevent closing by clicking outside
            allowEscapeKey: false     // prevent closing with Esc
        }).then(() => {
            // If still NOT OK, show popup again
            if (voltageStatus === "NOT OK") {
                showVoltagePopup();
            } else {
                handleBarcode2(globalBatteryFinalQRCode);
            }
        });
    }

    if (voltageStatus === "NOT OK") {
        showVoltagePopup();
    } else {
        handleBarcode2(globalBatteryFinalQRCode);
    }
});
       /////////VIR api interlock 
