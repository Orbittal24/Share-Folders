const axios = require("axios");

socket.on("getIBB_status", async (battery_qrcode) => {
    try {
        const requestData = {
            station_id: 30,
            line_id: 3,
            customer_qrcode: battery_qrcode
        };

        console.log("requestData:::::::", requestData);

        // Call API using axios GET
        const response = await axios.get(
            "https://mismainapp.tataautocomp.com:3241/station_interlock",
            {
                params: requestData,
                headers: {
                    "Content-Type": "application/json",
                },
            }
        );

        console.log("API result:", JSON.stringify(response.data, null, 2));

        // Send API response back to frontend
        socket.emit("setIBB_status", response.data, battery_qrcode);

    } catch (error) {
        console.error(
            "Interlock API error:",
            error.response?.status,
            error.response?.statusText || error.message
        );
        socket.emit("setIBB_status", { error: true }, battery_qrcode);
    }
});
