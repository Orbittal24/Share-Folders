from datetime import datetime

def find_process_register_table(cursor, process_time):
    process_date_str = process_time.strftime("%d-%m-%y")
    candidates = []

    cursor.execute("""
        SELECT TABLE_NAME
        FROM INFORMATION_SCHEMA.TABLES
        WHERE TABLE_SCHEMA = 'taco_treceability'
          AND TABLE_NAME LIKE ?
    """, (f"Process_Register_{process_date_str}%",))

    for (table_name,) in cursor.fetchall():
        try:
            # Process_Register_24-12-25_26-12-25
            start_str, end_str = table_name.replace(
                f"Process_Register_{process_date_str}_", ""
            ).split("_")

            end_date = datetime.strptime(end_str, "%d-%m-%y").date()
            candidates.append((end_date, table_name))

        except Exception:
            continue

    if not candidates:
        return None

    # pick table with latest end_date
    candidates.sort(reverse=True)
    return candidates[0][1]
