const fetch = require("node-fetch");

const fetch = require("node-fetch");

socket.on("getIBB_status", async (battery_qrcode) => {
    try {
        const requestData = {
            station_id: 30,
            line_id: 3,
            customer_qrcode: battery_qrcode
        };

        console.log("requestData:::::::", requestData);

        const response = await fetch(
            "https://mismainapp.tataautocomp.com:3241/station_interlock",
            {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(requestData),
            }
        );

        if (!response.ok) {
            console.error(
                "Interlock API error:",
                response.status,
                response.statusText
            );
            socket.emit("setFinalQRCodeStatus", { error: true }, battery_qrcode);
            return;
        }

        const result = await response.json();
        console.log("API result:", JSON.stringify(result, null, 2));

        socket.emit("setFinalQRCodeStatus", result, battery_qrcode);

    } catch (error) {
        console.error("API error:", error);
        socket.emit("setFinalQRCodeStatus", { error: true }, battery_qrcode);
    }
});
