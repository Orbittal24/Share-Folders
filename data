1Ô∏è‚É£ Create an Extended Event session for FAILED QUERIES
üîπ Step 1: Run this in SSMS (once)
CREATE EVENT SESSION Failed_SQL_Queries
ON SERVER
ADD EVENT sqlserver.error_reported
(
    ACTION
    (
        sqlserver.sql_text,
        sqlserver.client_hostname,
        sqlserver.username,
        sqlserver.database_name,
        sqlserver.session_id
    )
    WHERE severity >= 11   -- captures real errors only
)
ADD TARGET package0.event_file
(
    SET filename = 'C:\SQLLogs\FailedQueries.xel',
        max_file_size = 50,
        max_rollover_files = 10
);
GO


üìå This captures:

All failed SQL statements

From any application (Node, SSMS, jobs, etc.)

Across all databases

2Ô∏è‚É£ Start the Event Session
ALTER EVENT SESSION Failed_SQL_Queries
ON SERVER
STATE = START;
GO


From this moment ‚Üí every failed query is logged automatically üéØ

3Ô∏è‚É£ View Failed Queries in SSMS

Run this query anytime:

SELECT
    event_data.value('(event/@timestamp)[1]', 'datetime2') AS event_time,
    event_data.value('(event/action[@name="database_name"]/value)[1]', 'sysname') AS database_name,
    event_data.value('(event/action[@name="username"]/value)[1]', 'sysname') AS username,
    event_data.value('(event/action[@name="client_hostname"]/value)[1]', 'nvarchar(256)') AS client_host,
    event_data.value('(event/action[@name="sql_text"]/value)[1]', 'nvarchar(max)') AS failed_query,
    event_data.value('(event/data[@name="message"]/value)[1]', 'nvarchar(max)') AS error_message
FROM
(
    SELECT CAST(event_data AS XML) AS event_data
    FROM sys.fn_xe_file_target_read_file(
        'C:\SQLLogs\FailedQueries*.xel',
        NULL, NULL, NULL
    )
) t
ORDER BY event_time DESC;



///////////////////////////////////////////////////////////////
1Ô∏è‚É£ Stop the event session (if it‚Äôs running)
ALTER EVENT SESSION Failed_SQL_Queries
ON SERVER
STATE = STOP;
GO

2Ô∏è‚É£ Drop (delete) the event session
DROP EVENT SESSION Failed_SQL_Queries
ON SERVER;
GO

3Ô∏è‚É£ (Optional) Verify it‚Äôs gone
SELECT name
FROM sys.server_event_sessions


üëâ You‚Äôll see exact SQL queries that failed, error messages, time, DB name, etc.
