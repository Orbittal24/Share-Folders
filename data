const normalizeStrict = (s) =>
  s
    .toLowerCase()
    .replace(/\s+/g, ' ')
    .trim();


else if (scanType === 'BOM') {
  const inputNorm = normalizeStrict(row.process_name);

  const matches = [];

  for (const p of pmResBom.recordset) {
    const procNorm = normalizeStrict(p.Process_Name);

    // ✅ Exact directional match first
    if (inputNorm === procNorm) {
      matches.push({
        score: 1,
        processID: p.Process_ID,
        totalCount: p.Total_Count,
        scanName: p.Scan_Name,
        processName: p.Process_Name
      });
      continue;
    }

    // ⚠️ fallback ONLY if no exact match exists
    const inputWords = inputNorm.split(' ');
    const procWords = procNorm.split(' ');

    const allMatch = inputWords.every(w => procWords.includes(w));

    if (allMatch) {
      matches.push({
        score: 0.8, // lower than exact
        processID: p.Process_ID,
        totalCount: p.Total_Count,
        scanName: p.Scan_Name,
        processName: p.Process_Name
      });
    }
  }

  matches.sort(
    (a, b) => b.score - a.score
  );

  best2 = matches[0];

  if (!best2?.processID) continue;
}
