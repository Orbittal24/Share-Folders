INSERT TRIGGER

USE [taco_treceability]
GO

CREATE TRIGGER trg_InsertTorqueDetailsEIP
ON [taco_treceability].[torque_details_EIP]
AFTER INSERT
AS
BEGIN
    SET NOCOUNT ON;

    INSERT INTO [taco_treceability].[torque_details_EIP_mirror] (
        [pack_name],
        [module_name],
        [torque],
        [angle],
        [torque_status],
        [date_dd],
        [shift],
        [module_barcode],
        [process_status],
        [pack_no],
        [rework_status],
        [bypass_operator],
        [bypass_reason],
        [process_name],
        [station_name],
        [smoke_sensor_linked_pack_no]
    )
    SELECT
        [pack_name],
        [module_name],
        [torque],
        [angle],
        [torque_status],
        [date_dd],
        [shift],
        [module_barcode],
        [process_status],
        [pack_no],
        [rework_status],
        [bypass_operator],
        [bypass_reason],
        [process_name],
        [station_name],
        [smoke_sensor_linked_pack_no]
    FROM inserted;
END;
GO

DELETE TRIGGER
USE [taco_treceability];
GO

DROP TRIGGER IF EXISTS [trg_InsertTorqueDetailsEIP];
GO

////////////////////////////////////////////////////////////////




//////////////////New update trigger 25 june
USE [taco_treceability]
GO

CREATE OR ALTER TRIGGER trg_UpdateTorqueDetailsEIP_Mirror
ON [taco_treceability].[torque_details_EIP]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;

    INSERT INTO [taco_treceability].[torque_details_EIP_mirror] (
        pack_name,
        module_name,
        torque,
        angle,
        torque_status,
        date_dd,
        shift,
        module_barcode,
        process_status,
        pack_no,
        rework_status,
        bypass_operator,
        bypass_reason,
        process_name,
        station_name,
        smoke_sensor_linked_pack_no
    )
    SELECT
        pack_name,
        module_name,
        torque,
        angle,
        torque_status,
        date_dd,
        shift,
        module_barcode,
        process_status,
        pack_no,
        rework_status,
        bypass_operator,
        bypass_reason,
        process_name,
        station_name,
        smoke_sensor_linked_pack_no
    FROM inserted;
END;
GO





/////////////INSERT NEW UPDATED RECORD OLDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD//////////
USE [taco_treceability]
GO

CREATE OR ALTER TRIGGER trg_UpdateTorqueDetailsEIP_Mirror
ON [taco_treceability].[torque_details_EIP]
AFTER UPDATE
AS
BEGIN
    SET NOCOUNT ON;

    INSERT INTO [taco_treceability].[torque_details_EIP_mirror] (
        pack_name,
        module_name,
        torque,
        angle,
        torque_status,
        date_dd,
        shift,
        module_barcode,
        process_status,
        pack_no,
        rework_status,
        bypass_operator,
        bypass_reason,
        process_name,
        station_name,
        smoke_sensor_linked_pack_no
    )
    SELECT
        i.pack_name,
        i.module_name,
        i.torque,
        i.angle,
        i.torque_status,
        i.date_dd,
        i.shift,
        i.module_barcode,
        i.process_status,
        i.pack_no,
        i.rework_status,
        i.bypass_operator,
        i.bypass_reason,
        i.process_name,
        i.station_name,
        i.smoke_sensor_linked_pack_no
    FROM inserted i
    INNER JOIN deleted d
        ON i.module_barcode = d.module_barcode
       AND i.date_dd = d.date_dd
       AND i.shift = d.shift
       AND i.torque = d.torque
       AND i.angle = d.angle
       AND i.process_name = d.process_name
    WHERE ISNULL(i.process_status, '') = ISNULL(d.process_status, '');
END;
GO



DELETE TRIGGER
USE [taco_treceability];
GO

DROP TRIGGER IF EXISTS [trg_UpdateTorqueDetailsEIP_Mirror];
GO
//////////////////////////////////////////
TO CHECK TRIGGER ON TABLE

USE [taco_treceability];
GO

SELECT 
    tr.name AS TriggerName,
    OBJECT_NAME(tr.parent_id) AS TableName,
    m.definition AS TriggerDefinition
FROM sys.triggers tr
JOIN sys.sql_modules m ON tr.object_id = m.object_id
WHERE m.definition LIKE '%torque_details_EIP_mirror%';
