socket.on("setFinalQRCodeStatus", function (data, battery_qrcode) {
    globalBatteryFinalQRCode = battery_qrcode;

    if (data.error) {
        Swal.fire("Error", "Could not fetch process status. Try again.", "error");
        return;
    }

    // Safely extract voltage_ir_status from rows[0]
    const voltageStatus = data[0]?.rows?.[0]?.voltage_ir_status || "OK";

    if (voltageStatus === "NOT OK") {
        Swal.fire({
            title: "Voltage IR Pending!",
            text: `Pending for module and barcode: ${globalBatteryFinalQRCode}`,
            icon: "info",
            confirmButtonText: "Bypass Check"
        }).then(() => {
            console.log("Bypassing checks:", globalBatteryFinalQRCode);
            checkPasscode("valid", globalBatteryFinalQRCode);
        });
    } else {
        // Status OK -> proceed normally
        handleBarcode2(globalBatteryFinalQRCode);
    }
});
